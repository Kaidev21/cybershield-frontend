<template>
  <div class="vulnerability-list">
    <div v-if="vulnerabilities.length === 0" class="empty-state">
      <Bug :size="48" />
      <p>Aucune vulnérabilité trouvée</p>
    </div>

    <div v-else class="vuln-table">
      <div class="table-header">
        <div class="col-cve">CVE</div>
        <div class="col-title">Titre</div>
        <div class="col-severity">Sévérité</div>
        <div class="col-cvss">CVSS</div>
        <div class="col-status">Statut</div>
        <div class="col-actions">Actions</div>
      </div>

      <div
          v-for="vuln in vulnerabilities"
          :key="vuln.id"
          class="table-row"
          :class="`severity-${vuln.severity}`"
      >
        <div class="col-cve">
          <code>{{ vuln.cve }}</code>
        </div>
        <div class="col-title">
          <div class="vuln-title">{{ vuln.title }}</div>
          <div class="vuln-systems">
            <Server :size="12" />
            {{ vuln.affectedSystems.join(', ') }}
          </div>
        </div>
        <div class="col-severity">
          <span class="severity-badge" :class="`badge-${vuln.severity}`">
            {{ vuln.severity }}
          </span>
        </div>
        <div class="col-cvss">
          <div class="cvss-score" :class="getCvssClass(vuln.cvss)">
            {{ vuln.cvss }}
          </div>
        </div>
        <div class="col-status">
          <span class="status-badge" :class="`status-${vuln.status}`">
            {{ getStatusLabel(vuln.status) }}
          </span>
        </div>
        <div class="col-actions">
          <button @click="viewDetails(vuln)" class="btn-action" title="Voir les détails">
            <Eye :size="18" />
          </button>
        </div>
      </div>
    </div>

    <!-- Details Modal -->
    <VulnerabilityDetails
        v-if="selectedVuln"
        :vulnerability="selectedVuln"
        @close="selectedVuln = null"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { Bug, Eye, Server } from 'lucide-vue-next'
import VulnerabilityDetails from './VulnerabilityDetails.vue'

defineProps({
  vulnerabilities: {
    type: Array,
    default: () => []
  }
})

const selectedVuln = ref(null)

const getCvssClass = (score) => {
  if (score >= 9) return 'cvss-critical'
  if (score >= 7) return 'cvss-high'
  if (score >= 4) return 'cvss-medium'
  return 'cvss-low'
}

const getStatusLabel = (status) => {
  const labels = {
    open: 'Ouverte',
    in_progress: 'En cours',
    resolved: 'Résolue'
  }
  return labels[status] || status
}

const viewDetails = (vuln) => {
  selectedVuln.value = vuln
}
</script>

<style scoped>
.vulnerability-list {
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px;
  color: #94a3b8;
}

.empty-state p {
  margin-top: 16px;
  font-size: 16px;
}

.vuln-table {
  display: flex;
  flex-direction: column;
}

.table-header {
  display: grid;
  grid-template-columns: 140px 2fr 120px 80px 120px 80px;
  gap: 16px;
  padding: 16px 24px;
  background: #f8fafc;
  border-bottom: 2px solid #e2e8f0;
  font-weight: 600;
  font-size: 13px;
  color: #64748b;
  text-transform: uppercase;
}

.table-row {
  display: grid;
  grid-template-columns: 140px 2fr 120px 80px 120px 80px;
  gap: 16px;
  padding: 20px 24px;
  border-bottom: 1px solid #f1f5f9;
  align-items: center;
  transition: all 0.2s;
  border-left: 4px solid transparent;
}

.table-row:hover {
  background: #f8fafc;
}

.table-row.severity-critical {
  border-left-color: #ef4444;
}

.table-row.severity-high {
  border-left-color: #f59e0b;
}

.table-row.severity-medium {
  border-left-color: #3b82f6;
}

.table-row.severity-low {
  border-left-color: #10b981;
}

.col-cve code {
  background: #f1f5f9;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 12px;
  color: #475569;
  font-weight: 600;
}

.vuln-title {
  font-weight: 600;
  color: #1e293b;
  font-size: 14px;
  margin-bottom: 4px;
}

.vuln-systems {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #94a3b8;
}

.severity-badge {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
}

.badge-critical {
  background: #fee2e2;
  color: #991b1b;
}

.badge-high {
  background: #fef3c7;
  color: #92400e;
}

.badge-medium {
  background: #dbeafe;
  color: #1e40af;
}

.badge-low {
  background: #d1fae5;
  color: #065f46;
}

.cvss-score {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border-radius: 8px;
  font-weight: 700;
  font-size: 16px;
}

.cvss-critical {
  background: #fee2e2;
  color: #991b1b;
}

.cvss-high {
  background: #fef3c7;
  color: #92400e;
}

.cvss-medium {
  background: #dbeafe;
  color: #1e40af;
}

.cvss-low {
  background: #d1fae5;
  color: #065f46;
}

.status-badge {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.status-open {
  background: #fef3c7;
  color: #92400e;
}

.status-in_progress {
  background: #dbeafe;
  color: #1e40af;
}

.status-resolved {
  background: #d1fae5;
  color: #065f46;
}

.btn-action {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  border: none;
  background: #f8fafc;
  color: #64748b;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.btn-action:hover {
  background: #667eea;
  color: white;
}

@media (max-width: 1200px) {
  .table-header,
  .table-row {
    grid-template-columns: 120px 1.5fr 100px 70px 100px 70px;
    gap: 12px;
    font-size: 12px;
  }
}
</style>